{% extends "layouts/base.html" %}
{% load static %}

{% block extrastyle %}
  {{ block.super }}
  <style>
    .tt-company-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(260px, 1fr)); gap: 16px; }
    .tt-company-card { border: 1px solid rgba(0,0,0,.06); border-radius: 18px; overflow:hidden; background:#fff; box-shadow: 0 14px 40px rgba(16, 24, 40, .06); transition: transform .15s ease, box-shadow .15s ease; }
    .tt-company-card:hover { transform: translateY(-2px); box-shadow: 0 18px 55px rgba(16, 24, 40, .10); }
    .tt-company-hero { height: 84px; background: radial-gradient(1200px 160px at 20% 20%, rgba(203, 12, 159, .18), transparent 60%),
                       radial-gradient(900px 160px at 80% 0%, rgba(17, 205, 239, .18), transparent 60%),
                       linear-gradient(135deg, rgba(33, 82, 255, .09), rgba(203, 12, 159, .06)); position: relative; }
    .tt-company-badge { position:absolute; left:16px; top:52px; width:64px; height:64px; border-radius: 18px; background:#fff; border:1px solid rgba(0,0,0,.06); display:flex; align-items:center; justify-content:center; box-shadow: 0 12px 30px rgba(16, 24, 40, .10); overflow:hidden; }
    .tt-company-badge img { width:100%; height:100%; object-fit: contain; padding: 6px; background: #fff; }
    .tt-company-initials { width:100%; height:100%; display:flex; align-items:center; justify-content:center; font-weight: 800; letter-spacing: .5px; color:#344767; background: radial-gradient(500px 80px at 30% 20%, rgba(17, 205, 239, .12), transparent 60%),
                          linear-gradient(135deg, rgba(33, 82, 255, .10), rgba(203, 12, 159, .08)); }
    /* Leave room for the floating logo badge so it doesn't overlap the title */
    .tt-company-body { padding: 42px 16px 14px 16px; }
    .tt-company-title { margin: 0 0 4px 0; font-size: 1.02rem; font-weight: 700; color:#344767; }
    .tt-company-sub { margin: 0 0 10px 0; font-size: .80rem; color: rgba(52, 71, 103, .75); }
    .tt-company-kpis { display:flex; gap: 10px; flex-wrap: wrap; }
    .tt-kpi { border:1px solid rgba(0,0,0,.06); border-radius: 14px; padding: 8px 10px; background: rgba(255,255,255,.7); min-width: 92px; }
    .tt-kpi .n { font-weight: 800; color:#344767; line-height:1; }
    .tt-kpi .l { font-size: .72rem; color: rgba(52, 71, 103, .70); }
    .tt-chip { display:inline-flex; align-items:center; gap:.35rem; padding:.22rem .55rem; border-radius: 999px; font-size: .72rem; border:1px solid rgba(0,0,0,.08); }
    .tt-chip.ok { background: rgba(46, 204, 113, .10); color: #1f7a3b; }
    .tt-chip.no { background: rgba(255, 99, 132, .10); color: #8b1a2b; }
    .tt-company-actions { display:flex; justify-content: flex-end; gap: 8px; padding: 0 16px 16px 16px; }
    .tt-company-actions a { border-radius: 12px; }
  </style>
{% endblock extrastyle %}

{% block content %}
<div class="container-fluid py-4">
  <div class="row">
    <div class="col-12">
      <div class="d-flex align-items-center justify-content-between mb-3">
        <div>
          <h5 class="mb-0">Empresas</h5>
          <p class="text-sm text-secondary mb-0">Gestiona empresas, geocercas y configuración base.</p>
        </div>
        <a href="{% url 'tt_empresa_create' %}" class="btn bg-gradient-primary mb-0">+ Nueva empresa</a>
      </div>

      <div class="tt-company-grid">
        {% for c in cards %}
          {% with e=c.empresa %}
            <div class="tt-company-card">
              <div class="tt-company-hero">
                <div class="tt-company-badge" aria-hidden="true">
                  {% if e.logo_url %}
                    <img src="{{ e.logo_url }}" alt="Logo" />
                  {% else %}
                    <div class="tt-company-initials">
                      {{ e.nombre_comercial|default:e.razon_social|default:'Empresa'|slice:":1"|upper }}
                    </div>
                  {% endif %}
                </div>
              </div>

              <div class="tt-company-body">
                <h6 class="tt-company-title">{{ e.nombre_comercial|default:e.razon_social }}</h6>
                <p class="tt-company-sub">
                  <span class="me-2">{{ e.pais }}</span>
                  {% if e.ruc_nit %}<span class="text-uppercase">· {{ e.ruc_nit }}</span>{% endif %}
                </p>

                <div class="d-flex align-items-center justify-content-between mb-2">
                  {% if c.has_geocerca %}
                    <span class="tt-chip ok"><i class="ni ni-check-bold"></i>Geocerca configurada</span>
                  {% else %}
                    <span class="tt-chip no"><i class="ni ni-bell-55"></i>Sin geocerca</span>
                  {% endif %}
                </div>

                <div class="tt-company-kpis">
                  <div class="tt-kpi">
                    <div class="n">{{ c.empleados }}</div>
                    <div class="l">Empleados</div>
                  </div>
                  <div class="tt-kpi">
                    <div class="n">{{ c.turnos }}</div>
                    <div class="l">Turnos</div>
                  </div>
                </div>
              </div>

              <div class="tt-company-actions">
                <a class="btn btn-sm btn-outline-secondary mb-0" href="{% url 'tt_empresa_update' e.id %}">Editar</a>
                <a class="btn btn-sm bg-gradient-primary mb-0" href="{% url 'tt_unidad_list' %}?empresa={{ e.id }}">Abrir</a>
              </div>
            </div>
          {% endwith %}
        {% empty %}
          <div class="card">
            <div class="card-body">
              <p class="text-sm text-secondary mb-0">No hay empresas registradas.</p>
            </div>
          </div>
        {% endfor %}
      </div>

    </div>
  </div>
</div>
{% endblock content %}
